!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).lootalot={})}(this,(function(t){"use strict";function r(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}function e(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){l=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(l)throw i}}}}function a(t){var r=function(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof r?r:r+""}function i(t){var r=.1400122886866665,e=Math.log(1-Math.pow(t,2))/r,n=2/Math.PI/r+Math.log(1-Math.pow(t,2))/2;return Math.sign(t)*Math.sqrt(Math.sqrt(Math.pow(n,2)-e)-n)}function u(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=1.4142135623730951;return i(2*t-1)*n*e+r}function l(t,r){if(r<=0)return 0;if(r>=1)return t;if(t<=v.MAX_REPEAT){for(var e=0,n=0;n<t;n++)e+=+(Math.random()<r);return e}var o=t*r,a=Math.sqrt(o*(1-r));return Math.round(c(u(Math.random(),o,a),0,t))}function f(t,r,e){if(r==e)return r*t;if(t<=v.MAX_REPEAT){for(var n=0,o=0;o<t;o++)n+=Math.floor(Math.random()*(e-r+1)+r);return n}var a=(e+r)/2*t,i=Math.sqrt((Math.pow(e-r,2)-1)/12*t);return Math.round(c(u(Math.random(),a,i),r*t,e*t))}function c(t,r,e){return Math.max(Math.min(t,e),r)}var s,v={ARITHMETIC_ERROR:1e-8,MAX_REPEAT:20,DEFAULT_TABLE_PREFS:{duplicateSearchMode:"equal"}};!function(t){t.equal="equal",t.strict_equal="strict_equal",t.json="json"}(s||(s={}));var h=function(){return function(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}((function t(){var r,n,a,i,u,l,f;e(this,t),this.pools=[],this.prefs=Object.assign({},v.DEFAULT_TABLE_PREFS),this.prefs=Object.assign({},v.DEFAULT_TABLE_PREFS);for(var c=arguments.length,s=new Array(c),h=0;h<c;h++)s[h]=arguments[h];for(var d=0,p=s;d<p.length;d++){var y=p[d],m=[];this.pools.push(m);var b,g=!1,w=!1,M=0,E=0,A=o(y);try{for(A.s();!(b=A.n()).done;){var T=b.value;if(g||(g=void 0!==T.w||void 0===T.p),w||(w=void 0!==T.p),M+=null!==(r=T.p)&&void 0!==r?r:0,E+=null!==(n=T.w)&&void 0!==n?n:1,g&&w)throw Error("All loot definitions in a pool must either use `p` for probability or `w` for weight");if((null!==(a=T.w)&&void 0!==a?a:1)<0)throw Error("Weight can not be negative");if((null!==(i=T.p)&&void 0!==i?i:0)<0)throw Error("Probabilty can not be negative")}}catch(t){A.e(t)}finally{A.f()}if(M>1+v.ARITHMETIC_ERROR)throw Error("All loot definitions in a pool must have their `p` values sum to 1 or less (sum = "+M+")");w&&(E=1);var P,R=o(y);try{for(R.s();!(P=R.n()).done;){var j=P.value;m.push({w:null!==(l=null!==(u=j.w)&&void 0!==u?u:j.p)&&void 0!==l?l:1,cascadeP:0,item:j.item,table:j.table,count:null!==(f=j.count)&&void 0!==f?f:1})}}catch(t){R.e(t)}finally{R.f()}w&&M<1-v.ARITHMETIC_ERROR&&m.push({w:1-M,cascadeP:0,count:1}),m.sort((function(t,r){return r.w-t.w}));for(var _=0,O=m;_<O.length;_++){var S=O[_];S.cascadeP=S.w/E,E-=S.w}m[m.length-1].cascadeP=1}}),[{key:"loot",value:function(t){var r=this,e=[];function n(t,n){var o=e.find((function(e){return n=e.item,o=t,r.isDuplicate.call(r,n,o);var n,o}));o?o.count+=n:e.push({item:t,count:n})}var a,i=o(this.pools);try{for(i.s();!(a=i.n()).done;){var u,c=a.value,s=t,v=o(c);try{var h,d=function(){var t=u.value,r=l(s,t.cascadeP);if(r<=0)return 0;s-=r;var e=0;if(e="number"==typeof t.count?r*t.count:f(r,t.count[0],t.count[1]),void 0!==t.table){var a=t.table.loot(e);void 0!==t.item&&(a=a.map((function(r){return Object.assign(Object.assign({},r),{item:Object.assign(Object.assign({},t.item),r.item)})})));var i,c=o(a);try{for(c.s();!(i=c.n()).done;){var v=i.value;n(v.item,v.count)}}catch(t){c.e(t)}finally{c.f()}}else void 0!==t.item&&n(t.item,e);return s<=0?1:void 0};for(v.s();!(u=v.n()).done&&(0===(h=d())||1!==h););}catch(t){v.e(t)}finally{v.f()}}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"isDuplicate",value:function(t,r){switch(this.prefs.duplicateSearchMode){case"equal":return t==r;case"strict_equal":return t===r;case"json":return JSON.stringify(t)==JSON.stringify(r)}}}])}();t.LootTable=h,t.prefs=v,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=lootalot.min.js.map
